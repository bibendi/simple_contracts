version: '2'

environment:
  DOCKER_RUBY_VERSION: 2.5
  RUBY_IMAGE_TAG: 2.5
  COMPOSE_FILE_EXT: local_volumes
  RAILS_ENV: test

compose:
  files:
    - docker-compose.yml
    - docker-compose.${COMPOSE_FILE_EXT}.yml

interaction:
  sh:
    service: app

  bundle:
    service: app
    command: bundle

  console:
    service: app
    command: ./bin/console

  rspec:
    service: app
    command: bundle exec rspec

  rubocop:
    service: app
    command: bundle exec rubocop

  clean:
    service: app
    command: rm -f Gemfile.lock

provision:
  - docker volume create --name bundler_data
  - dip clean
  - dip bundle install
